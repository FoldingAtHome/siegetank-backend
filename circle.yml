machine:
  python:
    version: 3.3.2

  environment:
    LANG: en_US.UTF-8

checkout:
  post:
    - if [[ ! -e redis/src/redis-server ]]; then cd redis/src && make -j4; fi

  cache_directories:
    - redis

dependencies:
  pre:
    - pip install tornado
    - pip install requests
    - pip install redis
    - pip install bcrypt
    - pip install pymongo
    - if [[ ! -e poco-1.5.2-all ]]; then wget http://pocoproject.org/releases/poco-1.5.2/poco-1.5.2-all.tar.gz && tar xvf poco-1.5.2-all.tar.gz && cd poco-1.5.2-all && ./configure --static --prefix=/home/ubuntu/poco152_install --omit=Data/MySQL,Data/ODBC && make -j4 && make install; fi
    - cd core && mkdir build && cd build && cmake ../ -DPOCOINSTALL_DIR=/home/ubuntu/poco152_install && make

  cache_directories:
    - poco-1.5.2-all
    - ../poco152_install

test:
  post:
    - /home/ubuntu/backend/core/tests/start_services
    - cd /home/ubuntu/backend/core/build/; make test